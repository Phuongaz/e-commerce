import{G as C,r as m,S as w,u as k,j as e,a as u,y as h,i as T}from"./index-CyFUtVx2.js";import{T as _}from"./Title-CGM5CABn.js";import{C as O}from"./CartTotal-BQWEAJWJ.js";function z(l){return C({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M294.1 256L167 129c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.3 34 0L345 239c9.1 9.1 9.3 23.7.7 33.1L201.1 417c-4.7 4.7-10.9 7-17 7s-12.3-2.3-17-7c-9.4-9.4-9.4-24.6 0-33.9l127-127.1z"},child:[]}]})(l)}const L=()=>{const{products:l,currency:f,cartItems:x,updateQuantity:g,navigate:c,loading:o,setLoading:i,token:p,backendUrl:j}=m.useContext(w),[d,b]=m.useState([]),y=k();m.useEffect(()=>{if(l.length>0){const t=Object.entries(x).flatMap(([r,s])=>Object.entries(s).filter(([n,a])=>a>0).map(([n,a])=>({_id:r,size:n,quantity:a})));b(t)}},[x,l]);const v=t=>{i(!0),c(t),setTimeout(()=>i(!1),500)},N=async()=>{var t,r;if(i(!0),!p)h.error("Vui lòng đăng nhập để đặt hàng",{position:"top-center",autoClose:1e3,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!1,draggable:!0,progress:void 0,theme:"light"}),i(!1),setTimeout(()=>{c("/login",{state:{from:y.pathname}})},1200);else try{const s=JSON.parse(localStorage.getItem("guestCart"))||{};Object.keys(s).length>0&&(await T.post(`${j}/api/cart`,{guestCart:s},{headers:{"Content-Type":"application/json",token:p},withCredentials:!0}),localStorage.removeItem("guestCart")),c("/place-order")}catch(s){console.error("Checkout error:",s),h.error(((r=(t=s.response)==null?void 0:t.data)==null?void 0:r.message)||"Có lỗi xảy ra khi xử lý giỏ hàng",{position:"top-center",autoClose:1500,hideProgressBar:!1,closeOnClick:!1,pauseOnHover:!1,draggable:!0,progress:void 0,theme:"light"})}finally{i(!1)}};return e.jsxs("div",{className:"border-t pt-14 relative px-4 sm:px-[5vw] md:px-[7vw] lg:px-[9vw]",children:[e.jsxs("div",{className:"relative flex justify-between items-start mb-3",children:[e.jsx("div",{className:"text-2xl",children:e.jsx(_,{text1:"Giỏ",text2:"Hàng"})}),d.length>0&&e.jsxs("button",{onClick:()=>c("/collection"),className:"flex items-center text-white bg-blue-700 hover:bg-blue-600 transition px-3 py-2 rounded font-medium",children:[e.jsx("span",{children:"Tiếp tục mua hàng"}),e.jsx(z,{className:"size-4 ml-1"})]})]}),d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center text-center",children:[e.jsx("img",{src:u.cartempty,alt:"Empty Cart",className:"w-40 sm:w-60 mb-4",loading:"lazy"}),e.jsx("p",{className:"text-2xl text-gray-900 font-medium",children:"Giỏ hàng của bạn trống!"}),e.jsx("p",{className:"text-gray-500 mb-6 text-sm",children:"Có vẻ như bạn chưa thêm gì vào giỏ hàng của mình."}),e.jsx("button",{onClick:()=>v("/collection"),className:"bg-black text-white px-6 py-2 text-sm rounded-md",children:"Mua hàng ngay"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:d.map((t,r)=>{const s=l.find(n=>n._id===t._id);return e.jsxs("div",{className:"py-4 border-t border-b text-gray-700 grid grid-cols-[4fr_0.5fr_0.5fr] sm:grid-cols-[4fr_2fr_0.5fr] items-center gap-4",children:[e.jsxs("div",{className:"flex items-start gap-6",children:[e.jsx("img",{className:"w-16 sm:w-20",src:s.image[0],alt:"product images"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-lg font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-5 mt-2",children:[e.jsxs("p",{children:[s.price," ",f]}),e.jsx("p",{className:"px-2 sm:px-3 sm:py-1 border bg-slate-50",children:t.size})]})]})]}),e.jsx("input",{className:"border max-w-10 sm:max-w-20 px-1 sm:px-2 py-1 focus:outline-none focus:border-gray-300",type:"number",min:1,defaultValue:t.quantity,onChange:n=>{let a=Number(n.target.value);(isNaN(a)||a<=0)&&(a=1),g(t._id,t.size,a)}}),e.jsx("img",{onClick:()=>g(t._id,t.size,0),src:u.bin_icon,alt:"bin icon",className:"w-4 sm:w-5 mr-4 cursor-pointer",loading:"lazy"})]},r)})}),e.jsx("div",{className:"flex justify-end my-20",children:e.jsxs("div",{className:"w-full sm:w-[450px]",children:[e.jsx(O,{}),e.jsx("div",{className:"w-full text-end",children:e.jsx("button",{onClick:N,className:` text-white w-52 h-11 text-sm my-8 bg-green-700 hover:bg-green-800
                      ${o?"cursor-not-allowed opacity-50":""}`,disabled:o,children:o?"Đang xử lý...":"TIẾP TỤC THANH TOÁN"})})]})})]})]})};export{L as default};
